{"version":3,"file":"react-permission.cjs.js","sources":["../src/provider.js","../src/defaults.js","../src/utils.js","../src/hook/useAuth.js","../src/permission.js"],"sourcesContent":["import React, { useState } from 'react';\n\nexport const AuthContext = React.createContext({});\n\nProvider.defaultProps = {\n    children: null,\n    permissions: [],\n    fallback: () => null\n};\n\nexport default function Provider({ children, permissions, fallback }) {\n    const [permissionKeys, setPermissions] = useState(permissions);\n\n    return (\n        <AuthContext.Provider\n            value={{\n                permissions: permissionKeys,\n                setPermissions, // 提供在子组件中修改权限的一个方法\n                fallback\n            }}\n        >\n            {children}\n        </AuthContext.Provider>\n    );\n}\n","export const UNPERMITTED = -1;\n\nexport const defaults = {\n    permissions: [],\n    fallback: () => null\n};\n","import { Children } from 'react';\nimport { UNPERMITTED } from './defaults';\n\nexport const find = (values, value) => {\n    let i = 0,\n        j = values.length - 1,\n        index = -1;\n    while (i <= j) {\n        let middle = Math.ceil((i + j) / 2);\n        let middleValue = values[middle];\n        if (middleValue > value) {\n            j = middle = middle - 1;\n        } else if (middleValue < value) {\n            i = middle = middle + 1;\n        } else {\n            return middle;\n        }\n    }\n\n    return index;\n};\n\nexport const filterChildElementByPermission = _props => {\n    const { children, fallback, permissions } = _props;\n\n    let elements = Children.map(children, element => {\n        const { permission, fallback: _fallback } = element.props;\n\n        // eslint-disable-next-line no-undef\n        if (__DEV__) {\n            console.log(permissions.join(','), '<-->', permission);\n        }\n\n        let index = find(permissions, permission);\n\n        if (UNPERMITTED === index) {\n            // do something if unpermitted\n            let showFallback = fallback || _fallback;\n            if (typeof showFallback === 'function') {\n                return showFallback();\n            } else {\n                throw TypeError('fallback 必须是一个合法的react组件');\n            }\n        }\n\n        return element;\n    });\n\n    return elements;\n};\n","import { useContext } from 'react';\nimport { AuthContext } from '../provider';\nimport { find } from '../utils';\nimport { UNPERMITTED } from '../defaults';\n\nexport default function usePermissions(key) {\n    const { permissions } = useContext(AuthContext);\n    return find(permissions, key) !== UNPERMITTED;\n}\n","import { useContext, useState, useEffect } from 'react';\nimport { defaults } from './defaults';\nimport { AuthContext } from './provider';\nimport { filterChildElementByPermission } from './utils';\n\nexport default function Permission(props) {\n    const _props = Object.assign({}, defaults, props, useContext(AuthContext));\n    const [ChildElements, setChildElements] = useState(_props.children);\n    useEffect(() => setChildElements(filterChildElementByPermission(_props)), [_props.permissions]);\n    return ChildElements;\n}\n"],"names":["AuthContext","React","createContext","Provider","defaultProps","children","permissions","fallback","useState","permissionKeys","setPermissions","UNPERMITTED","defaults","find","values","value","i","j","length","index","middle","Math","ceil","middleValue","filterChildElementByPermission","_props","elements","Children","map","element","props","permission","_fallback","console","log","join","showFallback","TypeError","usePermissions","key","useContext","Permission","Object","assign","ChildElements","setChildElements","useEffect"],"mappings":"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"}