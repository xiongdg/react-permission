{"version":3,"file":"react-permission.umd.js","sources":["../src/provider.js","../src/defaults.js","../src/utils.js","../src/hook/useAuth.js","../src/permission.js"],"sourcesContent":["import React, { useState } from 'react';\n\nexport const AuthContext = React.createContext({});\n\nProvider.defaultProps = {\n    children: null,\n    permissions: [],\n    fallback: () => null\n};\n\nexport default function Provider({ children, permissions, fallback }) {\n    const [permissionKeys, setPermissions] = useState(permissions);\n\n    return (\n        <AuthContext.Provider\n            value={{\n                permissions: permissionKeys,\n                setPermissions, // 提供在子组件中修改权限的一个方法\n                fallback\n            }}\n        >\n            {children}\n        </AuthContext.Provider>\n    );\n}\n","export const UNPERMITTED = -1;\n\nexport const defaults = {\n    permissions: [],\n    fallback: () => null\n};\n","import { Children } from 'react';\nimport { UNPERMITTED } from './defaults';\n\nexport const find = (values, value) => {\n    let i = 0,\n        j = values.length - 1,\n        index = -1;\n    while (i <= j) {\n        let middle = Math.ceil((i + j) / 2);\n        let middleValue = values[middle];\n        if (middleValue > value) {\n            j = middle = middle - 1;\n        } else if (middleValue < value) {\n            i = middle = middle + 1;\n        } else {\n            return middle;\n        }\n    }\n\n    return index;\n};\n\nexport const filterChildElementByPermission = _props => {\n    const { children, fallback, permissions } = _props;\n\n    let elements = Children.map(children, element => {\n        const { permission, fallback: _fallback } = element.props;\n\n        // eslint-disable-next-line no-undef\n        if (__DEV__) {\n            console.log(permissions.join(','), '<-->', permission);\n        }\n\n        let index = find(permissions, permission);\n\n        if (UNPERMITTED === index) {\n            // do something if unpermitted\n            let showFallback = fallback || _fallback;\n            if (typeof showFallback === 'function') {\n                return showFallback();\n            } else {\n                throw TypeError('fallback 必须是一个合法的react组件');\n            }\n        }\n\n        return element;\n    });\n\n    return elements;\n};\n","import { useContext } from 'react';\nimport { AuthContext } from '../provider';\nimport { find } from '../utils';\nimport { UNPERMITTED } from '../defaults';\n\nexport default function usePermissions(key) {\n    const { permissions } = useContext(AuthContext);\n    return find(permissions, key) !== UNPERMITTED;\n}\n","import { useContext, useState, useEffect } from 'react';\nimport { defaults } from './defaults';\nimport { AuthContext } from './provider';\nimport { filterChildElementByPermission } from './utils';\n\nexport default function Permission(props) {\n    const _props = Object.assign({}, defaults, props, useContext(AuthContext));\n    const [ChildElements, setChildElements] = useState(_props.children);\n    useEffect(() => setChildElements(filterChildElementByPermission(_props)), [_props.permissions]);\n    return ChildElements;\n}\n"],"names":["AuthContext","React","createContext","Provider","defaultProps","children","permissions","fallback","useState","permissionKeys","setPermissions","UNPERMITTED","defaults","find","values","value","i","j","length","index","middle","Math","ceil","middleValue","filterChildElementByPermission","_props","elements","Children","map","element","props","permission","_fallback","console","log","join","showFallback","TypeError","usePermissions","key","useContext","Permission","Object","assign","ChildElements","setChildElements","useEffect"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAEO,IAAMA,WAAW,GAAGC,cAAK,CAACC,aAAN,CAAoB,EAApB,CAApB;EAEPC,QAAQ,CAACC,YAAT,GAAwB;EACpBC,EAAAA,QAAQ,EAAE,IADU;EAEpBC,EAAAA,WAAW,EAAE,EAFO;EAGpBC,EAAAA,QAAQ,EAAE;EAAA,WAAM,IAAN;EAAA;EAHU,CAAxB;AAMA,EAAe,SAASJ,QAAT,OAAuD;EAAA,MAAnCE,QAAmC,QAAnCA,QAAmC;EAAA,MAAzBC,WAAyB,QAAzBA,WAAyB;EAAA,MAAZC,QAAY,QAAZA,QAAY;;EAAA,kBACzBC,cAAQ,CAACF,WAAD,CADiB;EAAA;EAAA,MAC3DG,cAD2D;EAAA,MAC3CC,cAD2C;;EAGlE,SACIT,6BAAC,WAAD,CAAa,QAAb;EACI,IAAA,KAAK,EAAE;EACHK,MAAAA,WAAW,EAAEG,cADV;EAEHC,MAAAA,cAAc,EAAdA,cAFG;EAEa;EAChBH,MAAAA,QAAQ,EAARA;EAHG;EADX,KAOKF,QAPL,CADJ;EAWH;;ECxBM,IAAMM,WAAW,GAAG,CAAC,CAArB;AAEP,EAAO,IAAMC,QAAQ,GAAG;EACpBN,EAAAA,WAAW,EAAE,EADO;EAEpBC,EAAAA,QAAQ,EAAE;EAAA,WAAM,IAAN;EAAA;EAFU,CAAjB;;ECCA,IAAMM,IAAI,GAAG,SAAPA,IAAO,CAACC,MAAD,EAASC,KAAT,EAAmB;EACnC,MAAIC,CAAC,GAAG,CAAR;EAAA,MACIC,CAAC,GAAGH,MAAM,CAACI,MAAP,GAAgB,CADxB;EAAA,MAEIC,KAAK,GAAG,CAAC,CAFb;;EAGA,SAAOH,CAAC,IAAIC,CAAZ,EAAe;EACX,QAAIG,MAAM,GAAGC,IAAI,CAACC,IAAL,CAAU,CAACN,CAAC,GAAGC,CAAL,IAAU,CAApB,CAAb;EACA,QAAIM,WAAW,GAAGT,MAAM,CAACM,MAAD,CAAxB;;EACA,QAAIG,WAAW,GAAGR,KAAlB,EAAyB;EACrBE,MAAAA,CAAC,GAAGG,MAAM,GAAGA,MAAM,GAAG,CAAtB;EACH,KAFD,MAEO,IAAIG,WAAW,GAAGR,KAAlB,EAAyB;EAC5BC,MAAAA,CAAC,GAAGI,MAAM,GAAGA,MAAM,GAAG,CAAtB;EACH,KAFM,MAEA;EACH,aAAOA,MAAP;EACH;EACJ;;EAED,SAAOD,KAAP;EACH,CAjBM;AAmBP,EAAO,IAAMK,8BAA8B,GAAG,SAAjCA,8BAAiC,CAAAC,MAAM,EAAI;EAAA,MAC5CpB,QAD4C,GACRoB,MADQ,CAC5CpB,QAD4C;EAAA,MAClCE,QADkC,GACRkB,MADQ,CAClClB,QADkC;EAAA,MACxBD,WADwB,GACRmB,MADQ,CACxBnB,WADwB;EAGpD,MAAIoB,QAAQ,GAAGC,cAAQ,CAACC,GAAT,CAAavB,QAAb,EAAuB,UAAAwB,OAAO,EAAI;EAAA,yBACDA,OAAO,CAACC,KADP;EAAA,QACrCC,UADqC,kBACrCA,UADqC;EAAA,QACfC,SADe,kBACzBzB,QADyB;;EAI7C,IAAa;EACT0B,MAAAA,OAAO,CAACC,GAAR,CAAY5B,WAAW,CAAC6B,IAAZ,CAAiB,GAAjB,CAAZ,EAAmC,MAAnC,EAA2CJ,UAA3C;EACH;;EAED,QAAIZ,KAAK,GAAGN,IAAI,CAACP,WAAD,EAAcyB,UAAd,CAAhB;;EAEA,QAAIpB,WAAW,KAAKQ,KAApB,EAA2B;EACvB;EACA,UAAIiB,YAAY,GAAG7B,QAAQ,IAAIyB,SAA/B;;EACA,UAAI,OAAOI,YAAP,KAAwB,UAA5B,EAAwC;EACpC,eAAOA,YAAY,EAAnB;EACH,OAFD,MAEO;EACH,cAAMC,SAAS,CAAC,0BAAD,CAAf;EACH;EACJ;;EAED,WAAOR,OAAP;EACH,GArBc,CAAf;EAuBA,SAAOH,QAAP;EACH,CA3BM;;ECjBQ,SAASY,cAAT,CAAwBC,GAAxB,EAA6B;EAAA,oBAChBC,gBAAU,CAACxC,WAAD,CADM;EAAA,MAChCM,WADgC,eAChCA,WADgC;;EAExC,SAAOO,IAAI,CAACP,WAAD,EAAciC,GAAd,CAAJ,KAA2B5B,WAAlC;EACH;;ECHc,SAAS8B,UAAT,CAAoBX,KAApB,EAA2B;EACtC,MAAML,MAAM,GAAGiB,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB/B,QAAlB,EAA4BkB,KAA5B,EAAmCU,gBAAU,CAACxC,WAAD,CAA7C,CAAf;;EADsC,kBAEIQ,cAAQ,CAACiB,MAAM,CAACpB,QAAR,CAFZ;EAAA;EAAA,MAE/BuC,aAF+B;EAAA,MAEhBC,gBAFgB;;EAGtCC,EAAAA,eAAS,CAAC;EAAA,WAAMD,gBAAgB,CAACrB,8BAA8B,CAACC,MAAD,CAA/B,CAAtB;EAAA,GAAD,EAAiE,CAACA,MAAM,CAACnB,WAAR,CAAjE,CAAT;EACA,SAAOsC,aAAP;EACH;;;;;;;;;;;;;;"}